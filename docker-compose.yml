services:
  postgresql-master:
    image: docker.io/bitnami/postgresql:latest
    ports:
      - '5432:5432'
    volumes:
      - 'postgresql_master_data:/bitnami/postgresql'
    environment:
      - POSTGRESQL_REPLICATION_MODE=master
      - POSTGRESQL_REPLICATION_USER=repl_user
      - POSTGRESQL_REPLICATION_PASSWORD=repl_password
      - POSTGRESQL_USERNAME=postgres
      - POSTGRESQL_PASSWORD=my_password
      - POSTGRESQL_DATABASE=my_database
      - ALLOW_EMPTY_PASSWORD=yes
#  postgresql-slave:
#    image: docker.io/bitnami/postgresql:latest
#    ports:
#      - '5433:5432'
#    depends_on:
#      - postgresql-master
#    environment:
#      - POSTGRESQL_REPLICATION_MODE=slave
#      - POSTGRESQL_REPLICATION_USER=repl_user
#      - POSTGRESQL_REPLICATION_PASSWORD=repl_password
#      - POSTGRESQL_MASTER_HOST=postgresql-master
#      - POSTGRESQL_PASSWORD=my_password
#      - POSTGRESQL_MASTER_PORT_NUMBER=5432
#      - ALLOW_EMPTY_PASSWORD=yes
#

  redis:
    image: redis:alpine
    restart: unless-stopped
    ports:
      - "6385:6379"
    volumes:
      - redis:/data
    command: redis-server --notify-keyspace-events KEA
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 10s
      timeout: 5s
      retries: 3

volumes:
  postgresql_master_data:
    driver: local
  redis:
