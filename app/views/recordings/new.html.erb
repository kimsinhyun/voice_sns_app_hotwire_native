<div class="w-full h-screen flex flex-col bg-gradient-to-br from-[#FDEBD0] to-[#FFF5E9]"
     data-controller="bridge--audio-recorder"
     data-bridge--audio-recorder-max-duration-value="10">
  
  <!-- ìƒë‹¨ í—¤ë” -->
  <div class="absolute top-0 left-0 right-0 pt-safe px-4 py-4 flex items-center justify-between z-10">
    <%= link_to feed_path, data: { turbo_frame: "_top" }, class: "text-gray-600 hover:text-gray-800 transition-colors" do %>
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    <% end %>
  </div>

  <!-- ë…¹ìŒ í™”ë©´ -->
  <div class="flex flex-col items-center justify-center flex-1"
       data-bridge--audio-recorder-target="recordingView">
    
    <!-- ì›í˜• ì§„í–‰ íƒ€ì´ë¨¸ -->
    <div class="relative w-64 h-64 mb-8">
      <!-- SVG ì›í˜• ì§„í–‰ ë°” -->
      <svg class="transform -rotate-90 w-64 h-64">
        <!-- ë°°ê²½ ì› -->
        <circle cx="128" cy="128" r="112" 
                stroke="currentColor" 
                stroke-width="8" 
                fill="none" 
                class="text-gray-200"/>
        <!-- ì§„í–‰ ì› -->
        <circle cx="128" cy="128" r="112" 
                stroke="currentColor" 
                stroke-width="8" 
                fill="none"
                stroke-dasharray="704"
                stroke-dashoffset="704"
                stroke-linecap="round"
                data-bridge--audio-recorder-target="circleProgress"
                class="text-red-500 transition-all duration-100 ease-linear"/>
      </svg>
      
      <!-- ì¤‘ì•™ íƒ€ì´ë¨¸ í…ìŠ¤íŠ¸ -->
      <div class="absolute inset-0 flex flex-col items-center justify-center">
        <div class="text-6xl font-light text-gray-700" 
             data-bridge--audio-recorder-target="timer">
          10.0
        </div>
        <div class="text-sm text-gray-500 mt-2">ì´ˆ ë‚¨ìŒ</div>
      </div>
    </div>

    <!-- ë…¹ìŒ ë²„íŠ¼ -->
    <div class="relative mb-4">
      <!-- ë…¹ìŒ ì¤‘ í„ìŠ¤ íš¨ê³¼ -->
      <div class="absolute inset-0 rounded-full bg-red-400 opacity-0 animate-ping"
           data-bridge--audio-recorder-target="pulse"
           style="display: none;"></div>
      
      <!-- ë©”ì¸ ë²„íŠ¼ -->
      <button type="button"
              data-action="click->bridge--audio-recorder#toggleRecording"
              data-bridge--audio-recorder-target="recordButton"
              class="relative w-20 h-20 rounded-full bg-gradient-to-br from-red-500 to-red-600 shadow-2xl hover:shadow-red-500/50 transform hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center">
        <!-- ë§ˆì´í¬ ì•„ì´ì½˜ -->
        <svg class="w-10 h-10 text-white" 
             data-bridge--audio-recorder-target="micIcon"
             fill="currentColor" 
             viewBox="0 0 24 24">
          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
          <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg>
        
        <!-- ì •ì§€ ì•„ì´ì½˜ -->
        <svg class="w-8 h-8 text-white hidden" 
             data-bridge--audio-recorder-target="stopIcon"
             fill="currentColor" 
             viewBox="0 0 24 24">
          <rect x="6" y="6" width="12" height="12" rx="2"/>
        </svg>
      </button>
    </div>

    <!-- ìƒíƒœ í…ìŠ¤íŠ¸ -->
    <div class="text-lg text-gray-600 text-center px-4"
         data-bridge--audio-recorder-target="statusText">
      íƒ­í•˜ì—¬ ë…¹ìŒ ì‹œì‘
    </div>
  </div>

  <!-- ë¯¸ë¦¬ë“£ê¸° í™”ë©´ (ë…¹ìŒ ì™„ë£Œ í›„ í‘œì‹œ) -->
  <div class="flex-1 flex-col items-center justify-between py-8 px-6 hidden"
       data-bridge--audio-recorder-target="previewView">
    
    <div class="flex-1 flex flex-col items-center justify-center">
      <!-- ì™„ë£Œ ë©”ì‹œì§€ -->
      <div class="text-center mb-8">
        <div class="text-5xl mb-4">âœ…</div>
        <div class="text-2xl font-medium text-gray-700 mb-2">ë…¹ìŒ ì™„ë£Œ!</div>
        <div class="text-gray-500" data-bridge--audio-recorder-target="recordedDuration">
          0.0ì´ˆ
        </div>
      </div>

      <!-- ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ -->
      <div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-6 mb-8">
        <!-- ì¬ìƒ ë²„íŠ¼ -->
        <div class="flex items-center gap-4 mb-4">
          <button type="button"
                  data-action="click->bridge--audio-recorder#togglePlayback"
                  data-bridge--audio-recorder-target="playButton"
                  class="w-14 h-14 rounded-full bg-gradient-to-br from-[#F5A08D] to-[#FFAA91] shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all flex items-center justify-center">
            <!-- ì¬ìƒ ì•„ì´ì½˜ -->
            <svg class="w-6 h-6 text-white ml-0.5" 
                 data-bridge--audio-recorder-target="playIcon"
                 fill="currentColor" 
                 viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"/>
            </svg>
            <!-- ì¼ì‹œì •ì§€ ì•„ì´ì½˜ -->
            <svg class="w-6 h-6 text-white hidden" 
                 data-bridge--audio-recorder-target="pauseIcon"
                 fill="currentColor" 
                 viewBox="0 0 24 24">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </button>
          
          <div class="flex-1">
            <!-- ì¬ìƒ ì§„í–‰ ë°” -->
            <div class="relative h-2 bg-gray-200 rounded-full overflow-hidden">
              <div class="absolute h-full bg-gradient-to-r from-[#F5A08D] to-[#FFAA91] transition-all duration-100"
                   data-bridge--audio-recorder-target="playbackProgress"
                   style="width: 0%"></div>
            </div>
            <!-- ì‹œê°„ í‘œì‹œ -->
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span data-bridge--audio-recorder-target="playbackTime">0:00</span>
              <span data-bridge--audio-recorder-target="playbackTotal">0:00</span>
            </div>
          </div>
        </div>

        <!-- íŒŒí˜• ì‹œê°í™” (ì¥ì‹ìš©) -->
        <div class="flex items-center justify-center gap-1 h-16 opacity-50">
          <% 30.times do |i| %>
            <div class="w-1 bg-gradient-to-t from-[#F5A08D] to-[#FFAA91] rounded-full" 
                 style="height: <%= rand(20..100) %>%"></div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ -->
    <div class="w-full flex gap-3 pb-safe">
      <button type="button"
              data-action="click->bridge--audio-recorder#cancel"
              class="flex-1 py-4 px-6 bg-white text-gray-700 font-semibold rounded-xl border-2 border-gray-200 hover:border-red-400 hover:text-red-500 transition-all duration-200">
        ì·¨ì†Œ
      </button>
      <button type="button"
              data-action="click->bridge--audio-recorder#submit"
              data-bridge--audio-recorder-target="submitButton"
              class="flex-1 py-4 px-6 bg-gradient-to-r from-[#F5A08D] to-[#FFAA91] text-white font-semibold rounded-xl hover:shadow-lg transform hover:scale-[1.02] active:scale-[0.98] transition-all duration-200">
        ê²Œì‹œí•˜ê¸°
      </button>
    </div>
  </div>

  <!-- ë¸Œë¼ìš°ì € ë¯¸ì§€ì› ë©”ì‹œì§€ -->
  <div class="absolute bottom-8 left-4 right-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-center hidden"
       id="browser-not-supported">
    <p class="text-sm text-yellow-800">
      ğŸ™ï¸ ì´ ë¸Œë¼ìš°ì €ëŠ” ë…¹ìŒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </p>
  </div>
</div>

<script>
  // ë¸Œë¼ìš°ì € ì§€ì› í™•ì¸
  if (!navigator.mediaDevices?.getUserMedia) {
    document.getElementById('browser-not-supported').classList.remove('hidden')
  }
</script>
