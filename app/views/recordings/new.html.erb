<div class="w-full h-screen flex flex-col bg-gradient-to-br from-[#FDEBD0] to-[#FFF5E9]"
     data-controller="bridge--audio-recorder"
     data-bridge--audio-recorder-max-duration-value="10">
  
  <!-- 상단 헤더 -->
  <div class="absolute top-0 left-0 right-0 pt-safe px-4 py-4 flex items-center justify-between z-10">
    <%= link_to feed_path, data: { turbo_frame: "_top" }, class: "text-gray-600 hover:text-gray-800 transition-colors" do %>
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    <% end %>
  </div>

  <!-- 녹음 화면 -->
  <div class="flex flex-col items-center justify-center flex-1"
       data-bridge--audio-recorder-target="recordingView">
    
    <!-- 원형 진행 타이머 -->
    <div class="relative w-64 h-64 mb-8">
      <!-- SVG 원형 진행 바 -->
      <svg class="transform -rotate-90 w-64 h-64">
        <!-- 배경 원 -->
        <circle cx="128" cy="128" r="112" 
                stroke="currentColor" 
                stroke-width="8" 
                fill="none" 
                class="text-gray-200"/>
        <!-- 진행 원 -->
        <circle cx="128" cy="128" r="112" 
                stroke="currentColor" 
                stroke-width="8" 
                fill="none"
                stroke-dasharray="704"
                stroke-dashoffset="704"
                stroke-linecap="round"
                data-bridge--audio-recorder-target="circleProgress"
                class="text-red-500 transition-all duration-100 ease-linear"/>
      </svg>
      
      <!-- 중앙 타이머 텍스트 -->
      <div class="absolute inset-0 flex flex-col items-center justify-center">
        <div class="text-6xl font-light text-gray-700" 
             data-bridge--audio-recorder-target="timer">
          10.0
        </div>
        <div class="text-sm text-gray-500 mt-2">초 남음</div>
      </div>
    </div>

    <!-- 녹음 버튼 -->
    <div class="relative mb-4">
      <!-- 녹음 중 펄스 효과 -->
      <div class="absolute inset-0 rounded-full bg-red-400 opacity-0 animate-ping"
           data-bridge--audio-recorder-target="pulse"
           style="display: none;"></div>
      
      <!-- 메인 버튼 -->
      <button type="button"
              data-action="click->bridge--audio-recorder#toggleRecording"
              data-bridge--audio-recorder-target="recordButton"
              class="relative w-20 h-20 rounded-full bg-gradient-to-br from-red-500 to-red-600 shadow-2xl hover:shadow-red-500/50 transform hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center">
        <!-- 마이크 아이콘 -->
        <svg class="w-10 h-10 text-white" 
             data-bridge--audio-recorder-target="micIcon"
             fill="currentColor" 
             viewBox="0 0 24 24">
          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
          <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg>
        
        <!-- 정지 아이콘 -->
        <svg class="w-8 h-8 text-white hidden" 
             data-bridge--audio-recorder-target="stopIcon"
             fill="currentColor" 
             viewBox="0 0 24 24">
          <rect x="6" y="6" width="12" height="12" rx="2"/>
        </svg>
      </button>
    </div>

    <!-- 상태 텍스트 -->
    <div class="text-lg text-gray-600 text-center px-4"
         data-bridge--audio-recorder-target="statusText">
      탭하여 녹음 시작
    </div>
  </div>

  <!-- 미리듣기 화면 (녹음 완료 후 표시) -->
  <div class="flex-1 flex-col items-center justify-between py-8 px-6 hidden"
       data-bridge--audio-recorder-target="previewView">
    
    <div class="flex-1 flex flex-col items-center justify-center">
      <!-- 완료 메시지 -->
      <div class="text-center mb-8">
        <div class="text-5xl mb-4">✅</div>
        <div class="text-2xl font-medium text-gray-700 mb-2">녹음 완료!</div>
        <div class="text-gray-500" data-bridge--audio-recorder-target="recordedDuration">
          0.0초
        </div>
      </div>

      <!-- 오디오 플레이어 -->
      <div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-6 mb-8">
        <!-- 재생 버튼 -->
        <div class="flex items-center gap-4 mb-4">
          <button type="button"
                  data-action="click->bridge--audio-recorder#togglePlayback"
                  data-bridge--audio-recorder-target="playButton"
                  class="w-14 h-14 rounded-full bg-gradient-to-br from-[#F5A08D] to-[#FFAA91] shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all flex items-center justify-center">
            <!-- 재생 아이콘 -->
            <svg class="w-6 h-6 text-white ml-0.5" 
                 data-bridge--audio-recorder-target="playIcon"
                 fill="currentColor" 
                 viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"/>
            </svg>
            <!-- 일시정지 아이콘 -->
            <svg class="w-6 h-6 text-white hidden" 
                 data-bridge--audio-recorder-target="pauseIcon"
                 fill="currentColor" 
                 viewBox="0 0 24 24">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </button>
          
          <div class="flex-1">
            <!-- 재생 진행 바 -->
            <div class="relative h-2 bg-gray-200 rounded-full overflow-hidden">
              <div class="absolute h-full bg-gradient-to-r from-[#F5A08D] to-[#FFAA91] transition-all duration-100"
                   data-bridge--audio-recorder-target="playbackProgress"
                   style="width: 0%"></div>
            </div>
            <!-- 시간 표시 -->
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span data-bridge--audio-recorder-target="playbackTime">0:00</span>
              <span data-bridge--audio-recorder-target="playbackTotal">0:00</span>
            </div>
          </div>
        </div>

        <!-- 파형 시각화 (장식용) -->
        <div class="flex items-center justify-center gap-1 h-16 opacity-50">
          <% 30.times do |i| %>
            <div class="w-1 bg-gradient-to-t from-[#F5A08D] to-[#FFAA91] rounded-full" 
                 style="height: <%= rand(20..100) %>%"></div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- 하단 액션 버튼 -->
    <div class="w-full flex gap-3 pb-safe">
      <button type="button"
              data-action="click->bridge--audio-recorder#cancel"
              class="flex-1 py-4 px-6 bg-white text-gray-700 font-semibold rounded-xl border-2 border-gray-200 hover:border-red-400 hover:text-red-500 transition-all duration-200">
        취소
      </button>
      <button type="button"
              data-action="click->bridge--audio-recorder#submit"
              data-bridge--audio-recorder-target="submitButton"
              class="flex-1 py-4 px-6 bg-gradient-to-r from-[#F5A08D] to-[#FFAA91] text-white font-semibold rounded-xl hover:shadow-lg transform hover:scale-[1.02] active:scale-[0.98] transition-all duration-200">
        게시하기
      </button>
    </div>
  </div>

  <!-- 브라우저 미지원 메시지 -->
  <div class="absolute bottom-8 left-4 right-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-center hidden"
       id="browser-not-supported">
    <p class="text-sm text-yellow-800">
      🎙️ 이 브라우저는 녹음을 지원하지 않습니다.
    </p>
  </div>
</div>

<script>
  // 브라우저 지원 확인
  if (!navigator.mediaDevices?.getUserMedia) {
    document.getElementById('browser-not-supported').classList.remove('hidden')
  }
</script>
